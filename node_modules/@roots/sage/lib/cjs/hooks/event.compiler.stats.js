"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const bud_support_1 = require("@roots/bud-support");
const fs_extra_1 = require("fs-extra");
const url_1 = require("url");
const { writeJson } = bud_support_1.fs;
/**
 * Event compiler done hook
 *
 * @remarks
 * Generates and emits `hmr.json` with proxy/dev server information
 * for use in Acorn.
 *
 * @param stats - webpack stats object
 * @returns stats
 *
 * @public
 */
async function default_1(stats) {
    try {
        const contents = {
            dev: (0, url_1.urlToHttpOptions)(this.store.get('server.dev.url')) ?? null,
            proxy: (0, url_1.urlToHttpOptions)(this.store.get('server.proxy.url')) ?? null,
            publicPath: this.hooks.filter('build.output.publicPath') ?? null,
            hash: stats ? stats.hash : null,
        };
        await (0, fs_extra_1.ensureDir)(this.path('dist'));
        await writeJson(this.path('dist', 'hmr.json'), contents);
    }
    catch (error) {
        throw new Error(error);
    }
    return stats;
}
exports.default = default_1;

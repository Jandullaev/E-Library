"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.minimize = void 0;
const minimize_constants_1 = require("./minimize.constants");
const minimize_dependencies_1 = require("./minimize.dependencies");
/**
 * Enables minification of built assets.
 *
 * @example
 * Enable:
 *
 * ```js
 * bud.minimize()
 * ```
 *
 * @example
 * Explicitly disable:
 *
 * ```js
 * bud.minimize(false)
 * ```
 *
 * @example
 * Explicitly enable:
 *
 * ```js
 * bud.minimize(true)
 * ```
 *
 * @public
 */
const minimize = function (enabled = true, options) {
    this;
    enabled = enabled !== false;
    this.hooks.on('build.optimization.minimize', () => enabled);
    this.hooks.on('build.optimization.minimizer', (minimizer) => {
        minimizer.push(...(minimizer.includes('...') ? [] : ['...']), new minimize_dependencies_1.CssMinimizer({
            ...minimize_constants_1.cssMinimizerOptions,
            ...(options?.css ?? {}),
        }));
        return minimizer;
    });
    return this;
};
exports.minimize = minimize;

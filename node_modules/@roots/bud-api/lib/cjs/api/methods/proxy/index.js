"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.proxy = void 0;
const url_1 = require("url");
const proxy = function (config) {
    const ctx = this;
    if (typeof config === 'undefined') {
        ctx.api.log('log', 'enabling proxy');
        ctx.store.set('server.middleware.proxy', true);
        return ctx;
    }
    if (typeof config === 'boolean') {
        ctx.api.log('log', config ? 'enabling' : 'disabling', 'proxy');
        ctx.store.set('server.middleware.proxy', config);
        return ctx;
    }
    ctx.store.set('server.middleware.proxy', true);
    ctx.api.log('log', 'enabling proxy');
    if (typeof config === 'number') {
        const url = ctx.store.get('server.proxy.url');
        url.port = `${config}`;
        ctx.store.set('server.proxy.url', url);
        return ctx;
    }
    if (typeof config === 'string') {
        ctx.store.set('server.proxy.url', new url_1.URL(config));
        return ctx;
    }
    if (config instanceof url_1.URL) {
        ctx.store.set('server.proxy.url', config);
        return ctx;
    }
    ctx.api.log('error', {
        message: 'proxy fallthrough! maybe misconfiguration.',
        suffix: config,
    });
    return ctx;
};
exports.proxy = proxy;
